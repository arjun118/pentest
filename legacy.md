# nmap

let's start the enumeration with nmap,we get our results as..

```
nmap -Pn -A -p-65535 -sS --vv 10.129.185.114 
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-12 10:13 IST
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:13
Completed NSE at 10:13, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:13
Completed NSE at 10:13, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:13
Completed NSE at 10:13, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 10:13
Completed Parallel DNS resolution of 1 host. at 10:13, 0.05s elapsed
Initiating SYN Stealth Scan at 10:13
Scanning 10.129.185.114 [65535 ports]
Discovered open port 139/tcp on 10.129.185.114
Discovered open port 445/tcp on 10.129.185.114
SYN Stealth Scan Timing: About 4.14% done; ETC: 10:26 (0:11:59 remaining)
SYN Stealth Scan Timing: About 15.36% done; ETC: 10:20 (0:05:36 remaining)
SYN Stealth Scan Timing: About 23.39% done; ETC: 10:20 (0:04:58 remaining)
SYN Stealth Scan Timing: About 33.32% done; ETC: 10:20 (0:04:02 remaining)
SYN Stealth Scan Timing: About 44.52% done; ETC: 10:20 (0:03:42 remaining)
SYN Stealth Scan Timing: About 56.87% done; ETC: 10:20 (0:02:38 remaining)
SYN Stealth Scan Timing: About 67.30% done; ETC: 10:19 (0:01:56 remaining)
SYN Stealth Scan Timing: About 78.46% done; ETC: 10:19 (0:01:14 remaining)
Completed SYN Stealth Scan at 10:19, 312.85s elapsed (65535 total ports)
Initiating Service scan at 10:19
Scanning 2 services on 10.129.185.114
Completed Service scan at 10:19, 7.65s elapsed (2 services on 1 host)
Initiating OS detection (try #1) against 10.129.185.114
Retrying OS detection (try #2) against 10.129.185.114
Initiating Traceroute at 10:19
Completed Traceroute at 10:19, 0.44s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 10:19
Completed Parallel DNS resolution of 2 hosts. at 10:19, 0.06s elapsed
NSE: Script scanning 10.129.185.114.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:19
NSE Timing: About 99.28% done; ETC: 10:19 (0:00:00 remaining)
Completed NSE at 10:20, 53.30s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
Nmap scan report for 10.129.185.114
Host is up, received user-set (0.38s latency).
Scanned at 2021-08-12 10:13:57 IST for 383s
Not shown: 65532 filtered ports
Reason: 65532 no-responses
PORT     STATE  SERVICE       REASON          VERSION
139/tcp  open   netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp  open   microsoft-ds  syn-ack ttl 127 Windows XP microsoft-ds
3389/tcp closed ms-wbt-server reset ttl 127
Device type: general purpose|specialized
Running (JUST GUESSING): Microsoft Windows XP|2003|2000|2008 (94%), General Dynamics embedded (87%)
OS CPE: cpe:/o:microsoft:windows_xp::sp3 cpe:/o:microsoft:windows_server_2003::sp1 cpe:/o:microsoft:windows_server_2003::sp2 cpe:/o:microsoft:windows_2000::sp4 cpe:/o:microsoft:windows_server_2008::sp2
OS fingerprint not ideal because: Didn't receive UDP response. Please try again with -sSU
Aggressive OS guesses: Microsoft Windows XP SP3 (94%), Microsoft Windows Server 2003 SP1 or SP2 (92%), Microsoft Windows XP (92%), Microsoft Windows Server 2003 SP2 (92%), Microsoft Windows 2003 SP2 (91%), Microsoft Windows XP SP2 or Windows Server 2003 (91%), Microsoft Windows Server 2003 (90%), Microsoft Windows 2000 SP4 (90%), Microsoft Windows XP Professional SP3 (90%), Microsoft Windows XP SP2 (90%)
No exact OS matches for host (test conditions non-ideal).
TCP/IP fingerprint:
SCAN(V=7.91%E=4%D=8/12%OT=139%CT=3389%CU=%PV=Y%DS=2%DC=T%G=N%TM=6114A88C%P=x86_64-pc-linux-gnu)
SEQ(SP=105%GCD=1%ISR=109%TI=I%CI=I%TS=0)
SEQ(SP=106%GCD=1%ISR=109%TI=I%CI=I%II=I%SS=S%TS=0)
OPS(O1=M54BNW0NNT00NNS%O2=M54BNW0NNT00NNS%O3=M54BNW0NNT00%O4=M54BNW0NNT00NNS%O5=M54BNW0NNT00NNS%O6=M54BNNT00NNS)
WIN(W1=FAF0%W2=FAF0%W3=FAF0%W4=FAF0%W5=FAF0%W6=FAF0)
ECN(R=Y%DF=Y%TG=80%W=FAF0%O=M54BNW0NNS%CC=N%Q=)
T1(R=Y%DF=Y%TG=80%S=O%A=S+%F=AS%RD=0%Q=)
T2(R=N)
T3(R=N)
T4(R=Y%DF=N%TG=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)
T5(R=Y%DF=N%TG=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)
T6(R=Y%DF=N%TG=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)
T7(R=N)
U1(R=N)
IE(R=Y%DFI=S%TG=80%CD=Z)

Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=262 (Good luck!)
IP ID Sequence Generation: Incremental
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
|_clock-skew: mean: 5d00h27m39s, deviation: 2h07m15s, median: 4d22h57m40s
| nbstat: NetBIOS name: nil, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b9:75:cb (VMware)
| Names:
|   
| Statistics:
|   00 50 56 b9 75 cb 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 63662/tcp): CLEAN (Timeout)
|   Check 2 (port 8734/tcp): CLEAN (Timeout)
|   Check 3 (port 31950/udp): CLEAN (Timeout)
|   Check 4 (port 44942/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Windows XP (Windows 2000 LAN Manager)
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY\x00
|   Workgroup: HTB\x00
|_  System time: 2021-08-17T09:47:07+03:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)

TRACEROUTE (using port 3389/tcp)
HOP RTT       ADDRESS
1   433.18 ms 10.10.16.1
2   433.30 ms 10.129.185.114

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 384.03 seconds
           Raw packets sent: 131344 (5.783MB) | Rcvd: 440 (32.466KB)
```
well,let's break down the scan  results.

we can see standard ports on which smb operates on open(135,445)

along with that the aggressive detection on nmap gives us the os of the system can be - Microsoft Windows XP SP3 (94%)

I searched the exploit for microsoft windows xp and found that we can use  ms08-067 which is available on metasploit

which translates to the CVE [exploit](https://www.cvedetails.com/cve/CVE-2008-4250/)

so firing up metasploit and searching gives us.....

![metasploit](Images/metasploit-legacy.PNG)

setting options to the appropriate one's and firing off the exploit gives us a meterpreter session.

![session](/Images/session-legacy.PNG)

now executing getuid on this session gives that we are NT AUTHORITY\SYSTEM

Done :)
