# nmap

Let's get started with enumeration of the target.

upon enumerating our target with nmap ,we can see a lot of ports

IP of target at the time of enumeration: 10.129.135.127

```Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-10 10:11 IST
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:11
Completed NSE at 10:11, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:11
Completed NSE at 10:11, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:11
Completed NSE at 10:11, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 10:11
Completed Parallel DNS resolution of 1 host. at 10:11, 0.08s elapsed
Initiating SYN Stealth Scan at 10:11
Scanning 10.129.135.127 [65535 ports]
Discovered open port 445/tcp on 10.129.135.127
Discovered open port 21/tcp on 10.129.135.127
Discovered open port 139/tcp on 10.129.135.127
Discovered open port 22/tcp on 10.129.135.127
SYN Stealth Scan Timing: About 3.60% done; ETC: 10:25 (0:13:49 remaining)
Discovered open port 3632/tcp on 10.129.135.127
SYN Stealth Scan Timing: About 8.64% done; ETC: 10:23 (0:10:45 remaining)
SYN Stealth Scan Timing: About 14.16% done; ETC: 10:22 (0:09:12 remaining)
SYN Stealth Scan Timing: About 22.17% done; ETC: 10:20 (0:07:05 remaining)
SYN Stealth Scan Timing: About 33.72% done; ETC: 10:19 (0:04:57 remaining)
SYN Stealth Scan Timing: About 43.93% done; ETC: 10:18 (0:03:51 remaining)
SYN Stealth Scan Timing: About 53.52% done; ETC: 10:18 (0:03:04 remaining)
SYN Stealth Scan Timing: About 65.25% done; ETC: 10:19 (0:02:42 remaining)
SYN Stealth Scan Timing: About 74.47% done; ETC: 10:19 (0:01:55 remaining)
SYN Stealth Scan Timing: About 79.99% done; ETC: 10:19 (0:01:31 remaining)
SYN Stealth Scan Timing: About 85.73% done; ETC: 10:19 (0:01:08 remaining)
SYN Stealth Scan Timing: About 91.42% done; ETC: 10:19 (0:00:42 remaining)
Completed SYN Stealth Scan at 10:19, 492.18s elapsed (65535 total ports)
Initiating Service scan at 10:19
Scanning 5 services on 10.129.135.127
Completed Service scan at 10:19, 12.11s elapsed (5 services on 1 host)
Initiating OS detection (try #1) against 10.129.135.127
Retrying OS detection (try #2) against 10.129.135.127
Initiating Traceroute at 10:20
Completed Traceroute at 10:20, 0.29s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 10:20
Completed Parallel DNS resolution of 2 hosts. at 10:20, 0.05s elapsed
NSE: Script scanning 10.129.135.127.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:20
NSE: [ftp-bounce 10.129.135.127:21] PORT response: 500 Illegal PORT command.
NSE Timing: About 99.85% done; ETC: 10:20 (0:00:00 remaining)
Completed NSE at 10:20, 40.13s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 4.14s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
Nmap scan report for 10.129.135.127
Host is up, received user-set (0.30s latency).
Scanned at 2021-08-10 10:11:34 IST for 557s
Not shown: 65530 filtered ports
Reason: 65530 no-responses
PORT     STATE SERVICE     REASON         VERSION
21/tcp   open  ftp         syn-ack ttl 63 vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.16.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
| ssh-hostkey: 
|   1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA)
| ssh-dss AAAAB3NzaC1kc3MAAACBALz4hsc8a2Srq4nlW960qV8xwBG0JC+jI7fWxm5METIJH4tKr/xUTwsTYEYnaZLzcOiy21D3ZvOwYb6AA3765zdgCd2Tgand7F0YD5UtXG7b7fbz99chReivL0SIWEG/E96Ai+pqYMP2WD5KaOJwSIXSUajnU5oWmY5x85sBw+XDAAAAFQDFkMpmdFQTF+oRqaoSNVU7Z+hjSwAAAIBCQxNKzi1TyP+QJIFa3M0oLqCVWI0We/ARtXrzpBOJ/dt0hTJXCeYisKqcdwdtyIn8OUCOyrIjqNuA2QW217oQ6wXpbFh+5AQm8Hl3b6C6o8lX3Ptw+Y4dp0lzfWHwZ/jzHwtuaDQaok7u1f971lEazeJLqfiWrAzoklqSWyDQJAAAAIA1lAD3xWYkeIeHv/R3P9i+XaoI7imFkMuYXCDTq843YU6Td+0mWpllCqAWUV/CQamGgQLtYy5S0ueoks01MoKdOMMhKVwqdr08nvCBdNKjIEd3gH6oBk/YRnjzxlEAYBsvCmM4a0jmhz0oNiRWlc/F+bkUeFKrBx/D2fdfZmhrGg==
|   2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA)
|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAstqnuFMBOZvO3WTEjP4TUdjgWkIVNdTq6kboEDjteOfc65TlI7sRvQBwqAhQjeeyyIk8T55gMDkOD0akSlSXvLDcmcdYfxeIF0ZSuT+nkRhij7XSSA/Oc5QSk3sJ/SInfb78e3anbRHpmkJcVgETJ5WhKObUNf1AKZW++4Xlc63M4KI5cjvMMIPEVOyR3AKmI78Fo3HJjYucg87JjLeC66I7+dlEYX6zT8i1XYwa/L1vZ3qSJISGVu8kRPikMv/cNSvki4j+qDYyZ2E5497W87+Ed46/8P42LNGoOV8OcX/ro6pAcbEPUdUEfkJrqi2YXbhvwIJ0gFMb6wfe5cnQew==
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
3632/tcp open  distccd     syn-ack ttl 63 distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
Aggressive OS guesses: Linux 2.6.23 (92%), Belkin N300 WAP (Linux 2.6.30) (92%), Control4 HC-300 home controller (92%), D-Link DAP-1522 WAP, or Xerox WorkCentre Pro 245 or 6556 printer (92%), Dell Integrated Remote Access Controller (iDRAC5) (92%), Dell Integrated Remote Access Controller (iDRAC6) (92%), Linksys WET54GS5 WAP, Tranzeo TR-CPQ-19f WAP, or Xerox WorkCentre Pro 265 printer (92%), Linux 2.4.21 - 2.4.31 (likely embedded) (92%), Citrix XenServer 5.5 (Linux 2.6.18) (92%), Linux 2.6.18 (ClarkConnect 4.3 Enterprise Edition) (92%)
No exact OS matches for host (test conditions non-ideal).
TCP/IP fingerprint:
SCAN(V=7.91%E=4%D=8/10%OT=21%CT=%CU=%PV=Y%DS=2%DC=T%G=N%TM=611205AB%P=x86_64-pc-linux-gnu)
SEQ(SP=C3%GCD=1%ISR=CC%TI=Z%II=I%TS=7)
OPS(O1=M54BST11NW5%O2=M54BST11NW5%O3=M54BNNT11NW5%O4=M54BST11NW5%O5=M54BST11NW5%O6=M54BST11)
WIN(W1=16A0%W2=16A0%W3=16A0%W4=16A0%W5=16A0%W6=16A0)
ECN(R=Y%DF=Y%TG=40%W=16D0%O=M54BNNSNW5%CC=N%Q=)
T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)
T2(R=N)
T3(R=N)
T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)
U1(R=N)
IE(R=Y%DFI=N%TG=40%CD=S)

Uptime guess: 0.004 days (since Tue Aug 10 10:14:53 2021)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=194 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 2h00m36s, deviation: 2h49m45s, median: 34s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 7578/tcp): CLEAN (Timeout)
|   Check 2 (port 40181/tcp): CLEAN (Timeout)
|   Check 3 (port 61961/udp): CLEAN (Timeout)
|   Check 4 (port 27757/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)
|   Computer name: lame
|   NetBIOS computer name: 
|   Domain name: hackthebox.gr
|   FQDN: lame.hackthebox.gr
|_  System time: 2021-08-10T00:50:46-04:00
| smb-security-mode: 
|   account_used: <blank>
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)

TRACEROUTE (using port 445/tcp)
HOP RTT       ADDRESS
1   268.82 ms 10.10.16.1
2   268.87 ms 10.129.135.127

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:20
Completed NSE at 10:20, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 558.76 seconds
           Raw packets sent: 131459 (5.788MB) | Rcvd: 1084 (101.215KB) 
```

that's a lot of data there.let me break this down for you.

so,we can see ftp running on port 21,ssh on 22,samba services on 139,445 and a service named distccd on port 3632


Distcc is a tool for speeding up the compilation of source code by using distributed computing over a network. It can be used to compile programs quickly and configured to use multiple devices to aid in the compilation

### since I have included version detection flag in nmap,we got the version of samba which is 3.0.20

# searchsploit

I searched the same(samaba 3.0.20) in searchsploit and got back quite a few results.


![searchsploit](searchsploit-lame.PNG)

It's time we have checked metasploit regardin this finding.

# metasploit

so,starting metasploit with the command msfconsole and searching for samba 3.0.20 yields,

![metasploit](metasploit-lame.PNG)

yay,now we know there is an exploit,let's go ahead and use that

setting appropriate options,rhosts,lhost(set to out tun0 ip),and starting the exploit using the command run or exploit , I managed to get a session on the target machine.

run the following command to convert the shell into a interactive one.

>python -c 'import pty;pty.spawn("/bin/bash")'


![session](metasploit-lame2.PNG)

Ahh!yes,we are root :)

![flag](flag-txt.PNG)

